{% extends 'base.html' %}

{% block title %}User Recommendations - WatchWish{% endblock %}

{% block content %}
<section class="hero">
    <div class="header-content">
        <h1>
            Your Recommendations
        </h1>
        <p class="subtitle">Based on your ratings.</p>
    </div>
</section>

{% if error %}
<div class="empty-state">
    <h3>{{ error }}</h3>
    {% if user.is_authenticated %}
    <p>Start rating movies on the <a href="{% url 'index' %}" style="color: var(--primary-color);">Search page</a> to
        get personalized recommendations!</p>
    {% else %}
    <p>Try entering a different User ID.</p>
    {% endif %}
</div>
{% endif %}

{% if user_id and recommendations %}
<div class="mb-4" style="text-align: center; margin-bottom: 3rem;">
    <h3 style="font-size: 1.5rem; color: var(--text-secondary);">Top Picks for User #{{ user_id }}</h3>
</div>
{% endif %}

{% if recommendations %}
<div class="movies-grid">
    {% for movie in recommendations %}
    <div class="movie-card" onclick="window.location.href='{% url 'movie_detail' movie.movieId %}'">
        <div class="card-image-container">
            {% if movie.poster_url %}
            <img src="{{ movie.poster_url }}" alt="{{ movie.title }}" class="card-image" loading="lazy">
            {% else %}
            <div
                style="width:100%; height:100%; background: #333; display: flex; align-items: center; justify-content: center; color: #666;">
                No Poster
            </div>
            {% endif %}

            <div class="score-badge">
                {{ movie.recommendation_score|floatformat:1 }} Score
            </div>
        </div>
        <div class="card-content">
            <h3 class="card-title" title="{{ movie.title }}">{{ movie.title }}</h3>
            <div class="card-meta">
                {% for genre in movie.genre_list %}
                <span class="genre-tag">{{ genre }}</span>
                {% endfor %}
            </div>
            
            <div class="star-rating" style="flex-direction: row-reverse; justify-content: flex-end;" onclick="event.stopPropagation();">
                <span class="star" onclick="rateMovie('{{ movie.movieId }}', 5)" title="5 stars">★</span>
                <span class="star" onclick="rateMovie('{{ movie.movieId }}', 4)" title="4 stars">★</span>
                <span class="star" onclick="rateMovie('{{ movie.movieId }}', 3)" title="3 stars">★</span>
                <span class="star" onclick="rateMovie('{{ movie.movieId }}', 2)" title="2 stars">★</span>
                <span class="star" onclick="rateMovie('{{ movie.movieId }}', 1)" title="1 star">★</span>
            </div>
            
            {% if movie.description %}
            <p class="description">{{ movie.description }}</p>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% elif user_id and not error %}
<div class="empty-state">
    <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    <h3>Your recommendations are not ready</h3>
    <p>We don't have enough data yet. Rate more movies in the Search page to get live recommendations!</p>
</div>
{% else %}
{% if not error %}
<div class="empty-state">
    <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
    </svg>
    <h3>View Your Recommendations</h3>
    <p>Rate some movies to get personalized recommendations tailored just for you.</p>
</div>
{% endif %}
{% endif %}
{% endblock %}
