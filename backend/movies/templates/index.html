{% extends 'base.html' %}

{% block title %}Find Movies - WatchWish{% endblock %}

{% block content %}
<section class="hero">
    <h1>Discover Movies</h1>
    <p>Find similar movies based on what you love.</p>
</section>

<div class="search-container">
    <form method="get" class="search-form">
        {% csrf_token %}
        <input type="text" name="movie" class="search-input"
            placeholder="Enter a movie title (e.g., Unbeatable, Broken)..." value="{{ movie_title }}" required
            autocomplete="off">
        <button type="submit" class="search-button">
            Search
        </button>
    </form>
</div>

{% if error %}
<div class="empty-state">
    <div class="empty-icon">❌</div>
    <h3>{{ error }}</h3>
    <p>Try searching for a different movie.</p>
</div>
{% endif %}

{% if searched_movie %}
<div class="result-section">
    <h2>Found Movie</h2>
    <div class="movie-card result-card">
        <div class="card-image-container">
            {% if searched_movie.poster_url %}
            <img src="{{ searched_movie.poster_url }}" alt="{{ searched_movie.title }}" class="card-image"
                loading="lazy">
            {% else %}
            <div
                style="width:100%; height:100%; background: #333; display: flex; align-items: center; justify-content: center; color: #666;">
                No Poster
            </div>
            {% endif %}
        </div>
        <div class="card-content">
            <h3 class="card-title">{{ searched_movie.title }}</h3>
            <div class="card-meta">
                {% for genre in searched_movie.genre_list %}
                <span class="genre-tag">{{ genre }}</span>
                {% endfor %}
            </div>

            <div class="star-rating" style="flex-direction: row-reverse; justify-content: flex-end;">
                <span class="star" onclick="rateMovie('{{ searched_movie.movieId }}', 5)" title="5 stars">★</span>
                <span class="star" onclick="rateMovie('{{ searched_movie.movieId }}', 4)" title="4 stars">★</span>
                <span class="star" onclick="rateMovie('{{ searched_movie.movieId }}', 3)" title="3 stars">★</span>
                <span class="star" onclick="rateMovie('{{ searched_movie.movieId }}', 2)" title="2 stars">★</span>
                <span class="star" onclick="rateMovie('{{ searched_movie.movieId }}', 1)" title="1 star">★</span>
            </div>

            {% if searched_movie.description %}
            <p class="description">{{ searched_movie.description }}</p>
            {% endif %}
            
            <a href="{% url 'movie_detail' searched_movie.movieId %}" class="back-button" style="margin-top: 1rem; text-align: center; display: inline-block;">
                View Details
            </a>
        </div>
    </div>
</div>
{% endif %}

{% if recommendations %}
<div class="recommendations-section">
    <h2>
        {% if searched_movie %}
        Similar Movies You Might Like
        {% else %}
        Explore Popular Movies
        {% endif %}
    </h2>
    <div class="movies-grid">
        {% for movie in recommendations %}
        <div class="movie-card" onclick="window.location.href='{% url 'movie_detail' movie.movieId %}'">
            <div class="card-image-container">
                {% if movie.poster_url %}
                <img src="{{ movie.poster_url }}" alt="{{ movie.title }}" class="card-image" loading="lazy">
                {% else %}
                <div
                    style="width:100%; height:100%; background: #333; display: flex; align-items: center; justify-content: center; color: #666;">
                    No Poster
                </div>
                {% endif %}

                {% if movie.score %}
                <div class="score-badge">
                    {{ movie.score }} Match{{ movie.score|pluralize:"es" }}
                </div>
                {% endif %}
            </div>
            <div class="card-content">
                <h3 class="card-title" title="{{ movie.title }}">{{ movie.title }}</h3>
                <div class="card-meta">
                    {% for genre in movie.genre_list %}
                    <span class="genre-tag">{{ genre }}</span>
                    {% endfor %}
                </div>

                <div class="star-rating" style="flex-direction: row-reverse; justify-content: flex-end;" onclick="event.stopPropagation();">
                    <span class="star" onclick="rateMovie('{{ movie.movieId }}', 5)" title="5 stars">★</span>
                    <span class="star" onclick="rateMovie('{{ movie.movieId }}', 4)" title="4 stars">★</span>
                    <span class="star" onclick="rateMovie('{{ movie.movieId }}', 3)" title="3 stars">★</span>
                    <span class="star" onclick="rateMovie('{{ movie.movieId }}', 2)" title="2 stars">★</span>
                    <span class="star" onclick="rateMovie('{{ movie.movieId }}', 1)" title="1 star">★</span>
                </div>

                {% if movie.description %}
                <p class="description">{{ movie.description }}</p>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% else %}
{% if not error %}
<div class="empty-state">
    <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
    </svg>
    <h3>Start your search</h3>
    <p>Type a movie title above to get started.</p>
</div>
{% endif %}
{% endif %}
{% endblock %}
